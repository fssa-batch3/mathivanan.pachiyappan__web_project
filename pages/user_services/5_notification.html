<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification-Venom.com</title>
    <link rel="stylesheet" href="../../assets/css/3_home.css">
    <link rel="stylesheet" href="../../assets/css/5_notification.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="../../assets/images/logo.png" type="image/x-icon">
</head>

<body>
    <!--Header-->

    <div class="notific_main">
        <h1>
            Notifications<sup>
                <i class="fa fa-bell" style="color: #000;"></i>
            </sup>
        </h1>
        <div class="notific_top" id="notificationContent">
            <!--Notification_content_Js-->
        </div>
    </div>
    <div class="icons">
        <a href="#">
            <i class="fa fa-facebook" style="color: #000;"></i>
        </a>
        <a href="#">
            <i class="fa fa-instagram" style="color: #000;"></i>
        </a>
        <a href="#">
            <i class="fa fa-twitter" style="color: #000;"></i>
        </a>
        <a href="#">
            <i class="fa fa-github" style="color: #000;"></i>
        </a>
        <p>Â© 2023 Venom.com All rights reserved</p>
    </div>

    <script>
        // Retrieve user ID from URL parameter
        const params = new URLSearchParams(window.location.search);
        const userId = params.get('user_ID');

        // Retrieve blog records from localStorage
        const getPost = JSON.parse(localStorage.getItem("blog_records"));

        // Retrieve comment records from localStorage
        const commentRecord = JSON.parse(localStorage.getItem("comment_records"));

        // Retrieve like records from localStorage
        const likeItems = JSON.parse(localStorage.getItem("like_records"));

        // Filter comment records for the current user
        const userComment = commentRecord.filter((comment) => comment.other_user === userId);

        // Filter like records for the current user
        const userLikes = likeItems.filter((like) => like.user_id === userId);

        // Iterate over the user's comments and create notification elements
        const notificationContentElement = document.getElementById("notificationContent");

        const post_comment = userComment.filter(
            (comment) => comment.comment_post_id === postId
        );

        for (let i = 0; i < userComment.length; i++) {
            const comment = userComment[i];
            // let notificationUser;
            let content;

            if (comment.type === "like") {
                notificationUser = comment.user_id;
                content = " liked your";
            } else if (comment.type === "comment") {
                notificationUser = comment.user_id;
                content = " commented on your";
            }

            const comment_user = getPost.find((post) => post.user_email === userId);

            const notificationLink = document.createElement("a");
            notificationLink.href = `../posts/8-1_post.html?post_ID=${comment.comment_post_id}`;
            notificationLink.style.textDecoration = "none";
            notificationLink.style.color = "black";

            const notificationDiv = document.createElement("div");
            notificationDiv.classList.add("notific_profile");
            notificationLink.appendChild(notificationDiv);

            const profileImage = document.createElement("img");
            profileImage.src = comment.user_profile;
            profileImage.alt = "Profile Picture";
            profileImage.classList.add("profile_pic");
            notificationDiv.appendChild(profileImage);

            const notificationText = document.createElement("p");
            notificationText.classList.add("notific_card");
            const timestamp = ""; // You need to define the timestamp variable
            notificationText.innerHTML = `<strong class="bold">${userId}</strong> <span>${content} ${timestamp}</span>`;
            notificationDiv.appendChild(notificationText);

            notificationContentElement.prepend(notificationLink);
        }


        // // Create a "Clear All Notifications" button
        // const clearNotificationsButton = document.createElement("button");
        // clearNotificationsButton.setAttribute("class", "clear_Notification")
        // clearNotificationsButton.innerText = "Clear All Notifications";
        // clearNotificationsButton.addEventListener("click", clearNotifications);

        // // Append the button to the notification content element
        // notificationContentElement.appendChild(clearNotificationsButton);

        // // Function to clear all notifications for the user
        // function clearNotifications() {
        //     // Filter out the user's comments from the comment records
        //     const updatedRecords = commentRecordN.filter((e) => e.other_user !== userId);
        //     const updatedRecordsLike = likeItems.filter((e) => e.creatorId !== userId);
        //     // Save the updated records back to localStorage
        //     alert("Clear All!")
        //     localStorage.setItem("comment_records", JSON.stringify(updatedRecords));
        //     localStorage.setItem("like_records", JSON.stringify(updatedRecordsLike));
        //     // Remove the notification elements from the UI
        //     while (notificationContentElement.firstChild) {
        //         notificationContentElement.firstChild.remove();
        //     }
        // }

    </script>

    <script src="/assets/header.js"></script>
</body>

</html>