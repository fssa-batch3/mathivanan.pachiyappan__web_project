<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification-Venom.com</title>
    <link rel="stylesheet" href="../../assets/css/3_home.css">
    <link rel="stylesheet" href="../../assets/css/5_notification.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="../../assets/images/logo.png" type="image/x-icon">
</head>

<body>
    <!--Header-->

    <div class="notific_main">
        <h1>
            Notifications<sup>
                <i class="fa fa-bell" style="color: #000;"></i>
            </sup>
        </h1>
        <div class="notific_top" id="notificationContent">
            <!--Notification_content_Js-->
        </div>
    </div>
    <div class="icons">
        <a href="#">
            <i class="fa fa-facebook" style="color: #000;"></i>
        </a>
        <a href="#">
            <i class="fa fa-instagram" style="color: #000;"></i>
        </a>
        <a href="#">
            <i class="fa fa-twitter" style="color: #000;"></i>
        </a>
        <a href="#">
            <i class="fa fa-github" style="color: #000;"></i>
        </a>
        <p>Â© 2023 Venom.com All rights reserved</p>
    </div>

    <script>
        // Retrieve user ID from URL parameter
        const params = new URLSearchParams(window.location.search);
        const userId = params.get('user_ID');

        // Retrieve blog records from localStorage
        const getPost = JSON.parse(localStorage.getItem("blog_records")) || [];

        // Retrieve comment records from localStorage
        // const commentRecord = JSON.parse(localStorage.getItem("comment_records"));

        // // Retrieve like records from localStorage
        // const likeItems = JSON.parse(localStorage.getItem("like_records"));

        // // Filter comment records for the current user
        // const userComment = commentRecord.filter((comment) => comment.other_user === userId);

        // // Filter like records for the current user
        // const userLikes = likeItems.filter((like) => like.user_id === userId);

        // // Iterate over the user's comments and create notification elements
        const notificationContentElement = document.getElementById("notificationContent");

        const user_records = JSON.parse(localStorage.getItem("user_records")) || []

        // const post_comment = userComment.filter(
        //     (comment) => comment.comment_post_id === postId
        // );

        // Get the local storage data for likes, comments, and follows
        const likeRecords = JSON.parse(localStorage.getItem("like_records")) || [];
        const commentRecords = JSON.parse(localStorage.getItem("comment_records")) || [];
        const followRecords = JSON.parse(localStorage.getItem("follow_records")) || [];
        const user_Id = JSON.parse(localStorage.getItem("email_ID")) || [];

        let datenow = new Date()
        console.log(datenow)
        // for(let i = 0; i<likeRecords.length; i++){

        const user_like = likeRecords.filter((e) => e.creatorId === user_Id);
        const user_comment = commentRecords.filter((e) => e.creatorId === user_Id);

        const notification_data = user_like.concat(user_comment);
        console.log(notification_data)

        notification_data.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

     

        for (let i = 0; i < notification_data.length; i++) {
            const comment = notification_data[i];
            // let notificationUser;
            let content;

            
           let timeAgo;
            function calculateTimeDifference(postDate) {
            const currentDate = new Date();
            const postCreationDate = new Date(postDate);
            const timeDifference = currentDate.getTime() - postCreationDate.getTime();
            // Calculate the difference in seconds, minutes, hours, and days
            const seconds = Math.floor(timeDifference / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            // Determine the appropriate time unit to display
            let displayTime;
            if (days > 0) {
                timeAgo = `${days} day${days !== 1 ? 's' : ''} ago`;
            } else if (hours > 0) {
                timeAgo = `${hours} hour${hours !== 1 ? 's' : ''} ago`;
            } else if (minutes > 0) {
                timeAgo = `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
            } else {
                timeAgo = `${seconds} second${seconds !== 1 ? 's' : ''} ago`;
            }
            return displayTime;
        }

        calculateTimeDifference(comment.timestamp);


            if (comment.type === "like") {
                notificationUser = comment.userId;
                content = " liked your post |  " + timeAgo;
            } else if (comment.type === "comment") {
                notificationUser = comment.userId;
                content = " commented on your post | " + timeAgo;
            }

        

            const comment_user = user_records.filter((e) => e.user_email === notification_data[i].user_id);
            console.log(comment_user)

            const notificationLink = document.createElement("a");
            notificationLink.href = `../posts/8-1_post.html?post_ID=${comment.post_id}`;
            notificationLink.style.textDecoration = "none";
            notificationLink.style.color = "black";

            const notificationDiv = document.createElement("div");
            notificationDiv.classList.add("notific_profile");
            notificationLink.appendChild(notificationDiv);

            const profileImage = document.createElement("img");
            profileImage.src = comment_user[0].user_profile;
            profileImage.alt = "Profile Picture";
            profileImage.classList.add("profile_pic");
            notificationDiv.appendChild(profileImage);

            const notificationText = document.createElement("p");
            notificationText.classList.add("notific_card");
            const timestamp = ""; // You need to define the timestamp variable
            notificationText.innerHTML = `<strong class="bold">${comment_user[0].user_name}</strong> <span>${content} ${timestamp}</span>`;
            notificationDiv.appendChild(notificationText);

            notificationContentElement.prepend(notificationLink);
        }



    </script>

    <script src="/assets/header.js"></script>
</body>

</html>